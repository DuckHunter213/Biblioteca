mysql -u root

create database Biblioteca2_0;

use Biblioteca2_0;

SET FOREIGN_KEY_CHECKS=0

DROP TABLE IF EXISTS `Reservados` CASCADE
;

DROP TABLE IF EXISTS `Multas` CASCADE
;

DROP TABLE IF EXISTS `Devolucion` CASCADE
;

DROP TABLE IF EXISTS `Prestamos` CASCADE
;

DROP TABLE IF EXISTS `Usuarios` CASCADE
;

DROP TABLE IF EXISTS `Items` CASCADE
;

CREATE TABLE `Reservados`
(
	`folio` VARCHAR(50) NOT NULL,
	`matricula` VARCHAR(10),
	`identificador` VARCHAR(10),
	CONSTRAINT `PK_Table1` PRIMARY KEY (`folio`)
)
;

CREATE TABLE `Multas`
(
	`montoMulta` VARCHAR(50) NOT NULL,
	`folioMulta` VARCHAR(50) NOT NULL,
	`matricula` VARCHAR(10),
	`identificador` VARCHAR(10),
	CONSTRAINT `PK_Multas` PRIMARY KEY (`folioMulta`)
)
;

CREATE TABLE `Devolucion`
(
	`fechaDevolucion` DATE NOT NULL,
	`folioDevolucion` INTEGER NOT NULL,
	`folioPrestamo` VARCHAR(10),
	`identificador` VARCHAR(10),
	CONSTRAINT `PK_Devolucion` PRIMARY KEY (`folioDevolucion`)
)
;

CREATE TABLE `Prestamos`
(
	`fechaPrestamo` DATE NOT NULL,
	`folioPrestamo` VARCHAR(50) NOT NULL,
	`folioDevolucion` VARCHAR(50) NOT NULL,
	`fechaDevolucion` DATE,
	`identificador` VARCHAR(10),
	`matricula` VARCHAR(10),
	CONSTRAINT `PK_Prestamos` PRIMARY KEY (`folioPrestamo`)
)
;

CREATE TABLE `Usuarios`
(
	`matricula` VARCHAR(10) NOT NULL,
	`estado` VARCHAR(50) NOT NULL,
	`fechaRegistro` DATE NOT NULL,
	`periodoValidez` DATE NOT NULL,
	CONSTRAINT `PK_Usuarios` PRIMARY KEY (`matricula`)
)
;

CREATE TABLE `Items`
(
	`numeroPaginas` INTEGER NOT NULL,
	`tiempoPrestamo` DATE NOT NULL,
	`numeroEdicion` VARCHAR(10) NOT NULL,
	`autor` VARCHAR(50),
	`titulo` VARCHAR(150) NOT NULL,
	`identificador` VARCHAR(50) NOT NULL,
	`fechaAdquisicion` DATE,
	`costoMulta` VARCHAR(50) NOT NULL,
	`fechaPublicacion` DATE,
	`estadoPrestamo` BOOL NOT NULL,
	`folioPrestamo` VARCHAR(15) NOT NULL,
	`categoria` VARCHAR(50) NOT NULL,
	CONSTRAINT `PK_Items` PRIMARY KEY (`identificador`)
)
;

ALTER TABLE `Reservados` 
 ADD INDEX `IXFK_Reservados_Item` (`identificador` ASC)
;

ALTER TABLE `Reservados` 
 ADD INDEX `IXFK_Reservados_Usuarios` (`matricula` ASC)
;

ALTER TABLE `Multas` 
 ADD INDEX `IXFK_Multas_Item` (`identificador` ASC)
;

ALTER TABLE `Multas` 
 ADD INDEX `IXFK_Multas_Usuarios` (`matricula` ASC)
;

ALTER TABLE `Devolucion` 
 ADD INDEX `IXFK_Devolucion_Item` (`identificador` ASC)
;

ALTER TABLE `Devolucion` 
 ADD INDEX `IXFK_Devolucion_Prestamos` (`folioPrestamo` ASC)
;

ALTER TABLE `Prestamos` 
 ADD INDEX `IXFK_Prestamos_Item` (`identificador` ASC)
;

ALTER TABLE `Prestamos` 
 ADD INDEX `IXFK_Prestamos_Usuarios` (`matricula` ASC)
;

ALTER TABLE `Reservados` 
 ADD CONSTRAINT `FK_Reservados_Item`
	FOREIGN KEY (`identificador`) REFERENCES `Items` (`identificador`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Reservados` 
 ADD CONSTRAINT `FK_Reservados_Usuarios`
	FOREIGN KEY (`matricula`) REFERENCES `Usuarios` (`matricula`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Multas` 
 ADD CONSTRAINT `FK_Multas_Item`
	FOREIGN KEY (`identificador`) REFERENCES `Items` (`identificador`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Multas` 
 ADD CONSTRAINT `FK_Multas_Usuarios`
	FOREIGN KEY (`matricula`) REFERENCES `Usuarios` (`matricula`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Multas` 
 ADD CONSTRAINT `matriculaUsuario`
	FOREIGN KEY () REFERENCES  () ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `Devolucion` 
 ADD CONSTRAINT `FK_Devolucion_Item`
	FOREIGN KEY (`identificador`) REFERENCES `Items` (`identificador`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Devolucion` 
 ADD CONSTRAINT `FK_Devolucion_Prestamos`
	FOREIGN KEY (`folioPrestamo`) REFERENCES `Prestamos` (`folioPrestamo`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Prestamos` 
 ADD CONSTRAINT `FK_Prestamos_Item`
	FOREIGN KEY (`identificador`) REFERENCES `Items` (`identificador`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Prestamos` 
 ADD CONSTRAINT `FK_Prestamos_Usuarios`
	FOREIGN KEY (`matricula`) REFERENCES `Usuarios` (`matricula`) ON DELETE Restrict ON UPDATE Restrict
;

SET FOREIGN_KEY_CHECKS=1;

INSERT INTO `Items` VALUES (
	'10',
	CURRENT_DATE(),
	'2DA',
	'Galleta',
	'Como volver a comer lo que ya comiste',
	'S140111132',
	'2016-05-03 00:00:00',
	'10',
	'2016-05-01 00:00:00',
	'0',
	'',
	'Libro');
INSERT INTO `Usuarios` VALUES(	
	'S140111131',
	'Activo',
	'2015-05-03 00:00:00',
	'2018-05-03 00:00:00'
);